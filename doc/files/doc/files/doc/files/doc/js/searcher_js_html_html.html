<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>searcher_js_html.html</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="../../../../../../../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../../../../../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../../../../../../css/github.css" type="text/css" media="screen" />
<script src="../../../../../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../../../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../../../../../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../../../../../../../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>     
    <div class="banner">
        
        <h1>
            searcher_js_html.html
        </h1>
        <ul class="files">
            <li>doc/files/doc/files/doc/js/searcher_js_html.html</li>
            <li>Last modified: 2014-05-16 16:46:03 +0200</li>
        </ul>
    </div>

    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>&lt;!DOCTYPE html PUBLIC “-//W3C//DTD XHTML 1.0 Transitional//EN”</p>

<pre><code>&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</code></pre>

<p>&lt;html xmlns=“<a
href="http://www.w3.org/1999/xhtml">www.w3.org/1999/xhtml</a>”
xml:lang=“en” lang=“en”&gt; &lt;head&gt;</p>

<pre><code>&lt;title&gt;searcher_js.html&lt;/title&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;../../../../../css/reset.css&quot; type=&quot;text/css&quot; media=&quot;screen&quot; /&gt;</code></pre>

<p>&lt;link rel=“stylesheet” href=“../../../../../css/main.css”
type=“text/css” media=“screen” /&gt; &lt;link rel=“stylesheet”
href=“../../../../../css/github.css” type=“text/css” media=“screen” /&gt;
&lt;script src=“../../../../../js/jquery-1.3.2.min.js”
type=“text/javascript” charset=“utf-8”&gt;&lt;/script&gt; &lt;script
src=“../../../../../js/jquery-effect.js” type=“text/javascript”
charset=“utf-8”&gt;&lt;/script&gt; &lt;script
src=“../../../../../js/main.js” type=“text/javascript”
charset=“utf-8”&gt;&lt;/script&gt; &lt;script
src=“../../../../../js/highlight.pack.js” type=“text/javascript”
charset=“utf-8”&gt;&lt;/script&gt;</p>

<p>&lt;/head&gt;</p>

<p>&lt;body&gt;</p>

<pre><code>&lt;div class=&quot;banner&quot;&gt;

    &lt;h1&gt;
        searcher_js.html
    &lt;/h1&gt;
    &lt;ul class=&quot;files&quot;&gt;
        &lt;li&gt;doc/files/doc/js/searcher_js.html&lt;/li&gt;
        &lt;li&gt;Last modified: 2014-05-16 15:30:30 +0200&lt;/li&gt;
    &lt;/ul&gt;
&lt;/div&gt;

&lt;div id=&quot;bodyContent&quot;&gt;
    &lt;div id=&quot;content&quot;&gt;

&lt;div class=&quot;description&quot;&gt;</code></pre>

<p>&lt;p&gt;&amp;lt;!DOCTYPE html PUBLIC “-//W3C//DTD XHTML 1.0
Transitional//EN”&lt;/p&gt;</p>

<p>&lt;pre&gt;<code>&amp;quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</pre</code>&gt;</p>

<p>&lt;p&gt;&amp;lt;html xmlns=“&lt;a href=“<a
href="http://www.w3.org/1999/xhtml">www.w3.org/1999/xhtml</a">www.w3.org/1999/xhtml”>www.w3.org/1999/xhtml</a</a>&gt;”
xml:lang=“en” lang=“en”&amp;gt; &amp;lt;head&amp;gt;&lt;/p&gt;</p>

<p>&lt;pre&gt;<code>&amp;lt;title&amp;gt;searcher.js&amp;lt;/title&amp;gt;
&amp;lt;meta http-equiv=&amp;quot;Content-Type&amp;quot;
content=&amp;quot;text/html; charset=UTF-8&amp;quot; /&amp;gt; &amp;lt;link
rel=&amp;quot;stylesheet&amp;quot;
href=&amp;quot;../../../css/reset.css&amp;quot;
type=&amp;quot;text/css&amp;quot; media=&amp;quot;screen&amp;quot;
/&amp;gt;</code>&lt;/pre&gt;</p>

<p>&lt;p&gt;&amp;lt;link rel=“stylesheet” href=“../../../css/main.css”
type=“text/css” media=“screen” /&amp;gt; &amp;lt;link rel=“stylesheet”
href=“../../../css/github.css” type=“text/css” media=“screen” /&amp;gt;
&amp;lt;script src=“../../../js/jquery-1.3.2.min.js” type=“text/javascript”
charset=“utf-8”&amp;gt;&amp;lt;/script&amp;gt; &amp;lt;script
src=“../../../js/jquery-effect.js” type=“text/javascript”
charset=“utf-8”&amp;gt;&amp;lt;/script&amp;gt; &amp;lt;script
src=“../../../js/main.js” type=“text/javascript”
charset=“utf-8”&amp;gt;&amp;lt;/script&amp;gt; &amp;lt;script
src=“../../../js/highlight.pack.js” type=“text/javascript”
charset=“utf-8”&amp;gt;&amp;lt;/script&amp;gt;&lt;/p&gt;</p>

<p>&lt;p&gt;&amp;lt;/head&amp;gt;&lt;/p&gt;</p>

<p>&lt;p&gt;&amp;lt;body&amp;gt;&lt;/p&gt;</p>

<p>&lt;pre&gt;&lt;code&gt;&amp;lt;div class=&amp;quot;banner&amp;quot;&amp;gt;</p>

<pre><code>&amp;lt;h1&amp;gt;
    searcher.js
&amp;lt;/h1&amp;gt;
&amp;lt;ul class=&amp;quot;files&amp;quot;&amp;gt;
    &amp;lt;li&amp;gt;doc/js/searcher.js&amp;lt;/li&amp;gt;
    &amp;lt;li&amp;gt;Last modified: 2014-05-16 15:28:00 +0200&amp;lt;/li&amp;gt;
&amp;lt;/ul&amp;gt;</code></pre>

<p>&amp;lt;/div&amp;gt;</p>

<p>&amp;lt;div id=&amp;quot;bodyContent&amp;quot;&amp;gt;</p>

<pre><code>&amp;lt;div id=&amp;quot;content&amp;quot;&amp;gt;</code></pre>

<p>&amp;lt;div
class=&amp;quot;description&amp;quot;&amp;gt;&lt;/code&gt;&lt;/pre&gt;</p>

<p>&lt;p&gt;&amp;lt;p&amp;gt;Searcher = function(data)
{&amp;lt;/p&amp;gt;&lt;/p&gt;</p>

<p>&lt;p&gt;&amp;lt;pre&amp;gt;<code>this.data = data; this.handlers =
[];</code>&amp;lt;/pre&amp;gt;&lt;/p&gt;</p>

<p>&lt;p&gt;&amp;lt;p&amp;gt;}&amp;lt;/p&amp;gt;&lt;/p&gt;</p>

<p>&lt;p&gt;&amp;lt;p&amp;gt;Searcher.prototype = new function()
{&amp;lt;/p&amp;gt;&lt;/p&gt;</p>

<p>&lt;p&gt;&amp;lt;pre&amp;gt;&amp;lt;code&amp;gt;// search is performed in
chunks of 1000 for non-blocking user input var CHUNK_SIZE = 1000; // do not
try to find more than 100 results var MAX_RESULTS = 100; var huid = 1; var
suid = 1; var runs = 0;&lt;/p&gt;</p>

<p>&lt;p&gt;this.find = function(query) {&lt;/p&gt;</p>

<p>&lt;pre&gt;&lt;code&gt;var queries = splitQuery(query); var regexps =
buildRegexps(queries); var highlighters = buildHilighters(queries); var
state = { from: 0, pass: 0, limit: MAX_RESULTS, n: suid++}; var _this =
this;</p>

<p>this.currentSuid = state.n;</p>

<p>if (!query) return;</p>

<p>var run = function() {</p>

<pre><code>// stop current search thread if new search started
if (state.n != _this.currentSuid) return;

var results =
  performSearch(_this.data, regexps, queries, highlighters, state);
var hasMore = (state.limit &amp;amp;gt; 0 &amp;amp;amp;&amp;amp;amp; state.pass &amp;amp;lt; 4);

triggerResults.call(_this, results, !hasMore);
if (hasMore) {
  setTimeout(run, 2);
}
runs++;</code></pre>

<p>}; runs = 0;</p>

<p>// start search thread run();&lt;/code&gt;&lt;/pre&gt;</p>

<p>&lt;p&gt;}&lt;/p&gt;</p>

<p>&lt;pre&gt;<code>----- Events ------</code>&lt;/pre&gt;</p>

<p>&lt;p&gt;this.ready = function(fn) {&lt;/p&gt;</p>

<p>&lt;pre&gt;<code>fn.huid = huid; this.handlers.push(fn);</code>&lt;/pre&gt;</p>

<p>&lt;p&gt;}&lt;/p&gt;</p>

<p>&lt;pre&gt;<code>----- Utilities ------</code>&lt;/pre&gt;</p>

<p>&lt;p&gt;function splitQuery(query) {&lt;/p&gt;</p>

<p>&lt;pre&gt;&lt;code&gt;return jQuery.grep(query.split(/(s+|::?|()?)/),
function(string) {</p>

<pre><code>return string.match(/\S/)</code></pre>

<p>});&lt;/code&gt;&lt;/pre&gt;</p>

<p>&lt;p&gt;}&lt;/p&gt;</p>

<p>&lt;p&gt;function buildRegexps(queries) {&lt;/p&gt;</p>

<p>&lt;pre&gt;&lt;code&gt;return jQuery.map(queries, function(query) {</p>

<pre><code>return new RegExp(query.replace(/(.)/g, &amp;amp;#39;([$1])([^$1]*?)&amp;amp;#39;), &amp;amp;#39;i&amp;amp;#39;)</code></pre>

<p>});&lt;/code&gt;&lt;/pre&gt;</p>

<p>&lt;p&gt;}&lt;/p&gt;</p>

<p>&lt;p&gt;function buildHilighters(queries) {&lt;/p&gt;</p>

<p>&lt;pre&gt;&lt;code&gt;return jQuery.map(queries, function(query) {</p>

<pre><code>return jQuery.map(query.split(&amp;amp;#39;&amp;amp;#39;), function(l, i) {
  return &amp;amp;#39;\u0001$&amp;amp;#39; + (i*2+1) + &amp;amp;#39;\u0002$&amp;amp;#39; + (i*2+2);
}).join(&amp;amp;#39;&amp;amp;#39;);</code></pre>

<p>});&lt;/code&gt;&lt;/pre&gt;</p>

<p>&lt;p&gt;}&lt;/p&gt;</p>

<p>&lt;p&gt;// function longMatchRegexp(index, longIndex, regexps) { //    
for (var i</p>

<h1 id="label-regexps.length+-+1%3B+i+%26amp%3Bgt%3B%3D+0%3B+i%E2%80%93%29%7B+%2F%2F+++++++++if+%28%21%3Ca">regexps.length - 1; i &amp;amp;gt;= 0; i–){ //         if (!&lt;a</h1>

<p>href=“i”&gt;index.match(regexps&lt;/a&gt;) &amp;amp;amp;&amp;amp;amp;
!&lt;a href=“i”&gt;longIndex.match(regexps&lt;/a&gt;)) return false; //    
}; //</p>

<p>return true; // }&lt;/p&gt;</p>

<p>&lt;pre&gt;&lt;code&gt;  —– Mathchers ——</p>

<pre><code>This record matches if the index starts with queries[0] and the record
matches all of the regexps</code></pre>

<p>/&lt;/code&gt;&lt;/pre&gt;</p>

<p>&lt;p&gt;function matchPassBeginning(index, longIndex, queries, regexps)
{&lt;/p&gt;</p>

<p>&lt;pre&gt;&lt;code&gt;if (<a href="0">index.indexOf(queries</a>) != 0)
return false; for (var i=1, l = regexps.length; i &amp;amp;lt; l; i++) {</p>

<pre><code>if (!index.match(regexps[i]) &amp;amp;amp;&amp;amp;amp; !longIndex.match(regexps[i]))
  return false;</code></pre>

<p>}; return true;&lt;/code&gt;&lt;/pre&gt;</p>

<p>&lt;p&gt;}&lt;/p&gt;</p>

<p>&lt;p&gt;  &lt;/p&gt;</p>

<p>&lt;pre&gt;&lt;code&gt; This record matches if the longIndex starts with <a
href="0">queries</a> and the</p>

<pre><code>longIndex matches all of the regexps</code></pre>

<p>/&lt;/code&gt;&lt;/pre&gt;</p>

<p>&lt;p&gt;function matchPassLongIndex(index, longIndex, queries, regexps)
{&lt;/p&gt;</p>

<p>&lt;pre&gt;&lt;code&gt;if (<a href="0">longIndex.indexOf(queries</a>) != 0)
return false; for (var i=1, l = regexps.length; i &amp;amp;lt; l; i++) {</p>

<pre><code>if (!longIndex.match(regexps[i]))
  return false;</code></pre>

<p>}; return true;&lt;/code&gt;&lt;/pre&gt;</p>

<p>&lt;p&gt;}&lt;/p&gt;</p>

<p>&lt;p&gt;/*&lt;/p&gt;</p>

<p>&lt;pre&gt;&lt;code&gt; This record matches if the index contains <a
href="0">queries</a> and the record</p>

<pre><code>matches all of the regexps</code></pre>

<p>/&lt;/code&gt;&lt;/pre&gt;</p>

<p>&lt;p&gt;function matchPassContains(index, longIndex, queries, regexps)
{&lt;/p&gt;</p>

<p>&lt;pre&gt;&lt;code&gt;if (<a href="0">index.indexOf(queries</a>) == -1)
return false; for (var i=1, l = regexps.length; i &amp;amp;lt; l; i++) {</p>

<pre><code>if (!index.match(regexps[i]) &amp;amp;amp;&amp;amp;amp; !longIndex.match(regexps[i]))
  return false;</code></pre>

<p>}; return true;&lt;/code&gt;&lt;/pre&gt;</p>

<p>&lt;p&gt;}&lt;/p&gt;</p>

<p>&lt;p&gt;/*&lt;/p&gt;</p>

<p>&lt;pre&gt;&lt;code&gt; This record matches if <a href="0">regexps</a>
matches the index and the record</p>

<pre><code>matches all of the regexps</code></pre>

<p>/&lt;/code&gt;&lt;/pre&gt;</p>

<p>&lt;p&gt;function matchPassRegexp(index, longIndex, queries, regexps)
{&lt;/p&gt;</p>

<p>&lt;pre&gt;&lt;code&gt;if (!<a href="0">index.match(regexps</a>)) return
false; for (var i=1, l = regexps.length; i &amp;amp;lt; l; i++) {</p>

<pre><code>if (!index.match(regexps[i]) &amp;amp;amp;&amp;amp;amp; !longIndex.match(regexps[i]))
  return false;</code></pre>

<p>}; return true;&lt;/code&gt;&lt;/pre&gt;</p>

<p>&lt;p&gt;}&lt;/p&gt;</p>

<p>&lt;p&gt;/*  —– Highlighters ——&lt;/p&gt;</p>

<p>&lt;p&gt;function highlightRegexp(info, queries, regexps, highlighters)
{&lt;/p&gt;</p>

<p>&lt;pre&gt;&lt;code&gt;var result = createResult(info); for (var i=0, l =
regexps.length; i &amp;amp;lt; l; i++) {</p>

<pre><code>result.title = result.title.replace(regexps[i], highlighters[i]);
result.namespace = result.namespace.replace(regexps[i], highlighters[i]);</code></pre>

<p>}; return result;&lt;/code&gt;&lt;/pre&gt;</p>

<p>&lt;p&gt;}&lt;/p&gt;</p>

<p>&lt;p&gt;function hltSubstring(string, pos, length) {&lt;/p&gt;</p>

<p>&lt;pre&gt;<code>return string.substring(0, pos) +
&amp;amp;#39;\u0001&amp;amp;#39; + string.substring(pos, pos + length) +
&amp;amp;#39;\u0002&amp;amp;#39; + string.substring(pos +
length);</code>&lt;/pre&gt;</p>

<p>&lt;p&gt;}&lt;/p&gt;</p>

<p>&lt;p&gt;function highlightQuery(info, queries, regexps, highlighters)
{&lt;/p&gt;</p>

<p>&lt;pre&gt;&lt;code&gt;var result = createResult(info); var pos = 0; var
lcTitle = result.title.toLowerCase();</p>

<p>pos = <a href="0">lcTitle.indexOf(queries</a>); if (pos != -1) {</p>

<pre><code>result.title = hltSubstring(result.title, pos, queries[0].length);</code></pre>

<p>}</p>

<p>result.namespace = <a href="0">result.namespace.replace(regexps</a>, <a
href="0">highlighters</a>); for (var i=1, l = regexps.length; i
&amp;amp;lt; l; i++) {</p>

<pre><code>result.title = result.title.replace(regexps[i], highlighters[i]);
result.namespace = result.namespace.replace(regexps[i], highlighters[i]);</code></pre>

<p>}; return result;&lt;/code&gt;&lt;/pre&gt;</p>

<p>&lt;p&gt;}&lt;/p&gt;</p>

<p>&lt;p&gt;function createResult(info) {&lt;/p&gt;</p>

<p>&lt;pre&gt;<code>var result = {}; result.title = info[0]; result.namespace
= info[1]; result.path = info[2]; result.params = info[3]; result.snippet =
info[4]; return result;</code>&lt;/pre&gt;</p>

<p>&lt;p&gt;}&lt;/p&gt;</p>

<p>&lt;p&gt;/*  —– Searching ——     function performSearch(data, regexps,
queries, highlighters, state) {&lt;/p&gt;</p>

<p>&lt;pre&gt;&lt;code&gt;var searchIndex = data.searchIndex; var
longSearchIndex = data.longSearchIndex; var info = data.info; var result =
[]; var i = state.from; var l = searchIndex.length; var togo = CHUNK_SIZE;
var matchFunc, hltFunc;</p>

<p>while (state.pass &amp;amp;lt; 4 &amp;amp;amp;&amp;amp;amp; state.limit
&amp;amp;gt; 0 &amp;amp;amp;&amp;amp;amp; togo &amp;amp;gt; 0) {</p>

<pre><code>if (state.pass == 0) {
  matchFunc = matchPassBeginning;
  hltFunc = highlightQuery;
} else if (state.pass == 1) {
  matchFunc = matchPassLongIndex;
  hltFunc = highlightQuery;
} else if (state.pass == 2) {
  matchFunc = matchPassContains;
  hltFunc = highlightQuery;
} else if (state.pass == 3) {
  matchFunc = matchPassRegexp;
  hltFunc = highlightRegexp;
}

for (; togo &amp;amp;gt; 0 &amp;amp;amp;&amp;amp;amp; i &amp;amp;lt; l &amp;amp;amp;&amp;amp;amp; state.limit &amp;amp;gt; 0; i++, togo--) {
  if (info[i].n == state.n) continue;
  if (matchFunc(searchIndex[i], longSearchIndex[i], queries, regexps)) {
    info[i].n = state.n;
    result.push(hltFunc(info[i], queries, regexps, highlighters));
    state.limit--;
  }
};
if (searchIndex.length &amp;amp;lt;= i) {
  state.pass++;
  i = state.from = 0;
} else {
  state.from = i;
}</code></pre>

<p>} return result;&lt;/code&gt;&lt;/pre&gt;</p>

<p>&lt;p&gt;}&lt;/p&gt;</p>

<p>&lt;p&gt;function triggerResults(results, isLast) {&lt;/p&gt;</p>

<p>&lt;pre&gt;&lt;code&gt;jQuery.each(this.handlers, function(i, fn) {</p>

<pre><code>fn.call(this, results, isLast)</code></pre>

<p>})&lt;/code&gt;&lt;/pre&gt;</p>

<p>&lt;p&gt;}&amp;lt;/code&amp;gt;&amp;lt;/pre&amp;gt;&lt;/p&gt;</p>

<p>&lt;p&gt;&amp;lt;p&amp;gt;}&amp;lt;/p&amp;gt;&lt;/p&gt;</p>

<p>&lt;pre&gt;&lt;code&gt;  &amp;lt;/div&amp;gt;</p>

<pre><code>&amp;lt;!-- Methods --&amp;gt;
          &amp;lt;/div&amp;gt;

&amp;lt;/div&amp;gt;</code></pre>

<p>&amp;lt;/body&amp;gt;&lt;/code&gt;&lt;/pre&gt;</p>

<p>&lt;p&gt;&amp;lt;/html&amp;gt;&lt;/p&gt;</p>

<pre><code>  &lt;/div&gt;

  &lt;!-- Methods --&gt;
            &lt;/div&gt;

  &lt;/div&gt;
&lt;/body&gt;</code></pre>

<p>&lt;/html&gt;</p>

    </div>
  


  


  
  


  


  

  



  

    

    

    


    


    <!-- Methods -->
              </div>

    </div>
  </body>
</html>
